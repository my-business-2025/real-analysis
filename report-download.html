<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒì£¼ìš´ì „ ì‹¬ì¸µë¶„ì„ ë¦¬í¬íŠ¸ - SENSEMAKERS</title>
    <link rel="stylesheet" href="styles/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getStorage, ref, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js';
        
        // Firebase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •)
        const firebaseConfig = {
            apiKey: "AIzaSyBUFu8MIhZvkMkyUxWmp2CPcv1FMHoPXIw",
            authDomain: "datalife-mall.firebaseapp.com",
            projectId: "datalife-mall",
            storageBucket: "datalife-mall.firebasestorage.app",
            messagingSenderId: "102942608960",
            appId: "1:102942608960:web:e79f08dab085a8751719a5",
            measurementId: "G-SRG6JC2J8C"
        };
        
        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.firebaseStorage = storage;
        window.firebaseStorageMethods = { ref, getDownloadURL };
    </script>
    <style>
        .download-page {
            min-height: 80vh;
            padding: 60px 20px;
            text-align: center;
        }
        
        .download-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 60px 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .report-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }
        
        .report-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .report-description {
            font-size: 1.1rem;
            color: #666;
            line-height: 1.8;
            margin-bottom: 40px;
        }
        
        .report-price {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }
        
        .report-price .original {
            text-decoration: line-through;
            color: #999;
            margin-right: 15px;
        }
        
        .report-price .sale {
            color: #e74c3c;
            font-weight: 700;
            font-size: 2rem;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }
        
        .back-btn {
            background: transparent;
            color: #3498db;
            border: 2px solid #3498db;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .report-info {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid #eee;
            text-align: left;
        }
        
        .report-info h3 {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .report-info ul {
            list-style: none;
            padding: 0;
        }
        
        .report-info li {
            padding: 10px 0;
            color: #666;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .report-info li:last-child {
            border-bottom: none;
        }
        
        .report-info li i {
            color: #3498db;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo" onclick="window.location.href='index.html#home'" style="cursor: pointer;">
                    <h1 class="logo-text">SENSEMAKERS</h1>
                    <p class="logo-tagline">ë°ì´í„°ë¡œ ì¸ì‹ì„ ë§Œë“œëŠ” ì‚¬ëŒë“¤</p>
                </div>
                <div class="header-actions">
                    <div id="auth-buttons" class="auth-buttons">
                        <button id="login-btn" class="login-btn" onclick="window.location.href='index.html'">í™ˆìœ¼ë¡œ</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë‹¤ìš´ë¡œë“œ í˜ì´ì§€ -->
    <main class="main">
        <div class="download-page">
            <div class="download-container">
                <div class="report-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <h1 class="report-title">ìŒì£¼ìš´ì „ ì‹¬ì¸µë¶„ì„ ë¦¬í¬íŠ¸</h1>
                <p class="report-description">
                    ìŒì£¼ìš´ì „ ê´€ë ¨ ë°ì´í„°ë¥¼ ì‹¬ì¸µ ë¶„ì„í•˜ì—¬ í†µê³„, ì›ì¸, ëŒ€ì‘ ë°©ì•ˆì„ ì œì‹œí•˜ëŠ” ì „ë¬¸ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.<br>
                    ìµœì‹  ë°ì´í„°ì™€ ì „ë¬¸ê°€ ë¶„ì„ì„ í†µí•´ ìŒì£¼ìš´ì „ ë¬¸ì œì˜ ë³¸ì§ˆì„ íŒŒì•…í•˜ê³  í•´ê²°ì±…ì„ ëª¨ìƒ‰í•©ë‹ˆë‹¤.
                </p>
                
                <div class="report-price">
                    <span class="original">390,000ì›</span>
                    <span class="sale">150,000ì›</span>
                </div>
                
                <button class="download-btn" onclick="showPaymentForDownload()">
                    <i class="fas fa-download"></i> ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
                </button>
                
                <div>
                    <button class="back-btn" onclick="window.location.href='index.html'">
                        <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
                
                <div class="report-info">
                    <h3>ë¦¬í¬íŠ¸ êµ¬ì„±</h3>
                    <ul>
                        <li><i class="fas fa-check-circle"></i> ìŒì£¼ìš´ì „ í†µê³„ ë°ì´í„° ë¶„ì„</li>
                        <li><i class="fas fa-check-circle"></i> ìŒì£¼ìš´ì „ ë°œìƒ ì›ì¸ ë¶„ì„</li>
                        <li><i class="fas fa-check-circle"></i> ì§€ì—­ë³„/ì—°ë ¹ëŒ€ë³„ ìƒì„¸ ë¶„ì„</li>
                        <li><i class="fas fa-check-circle"></i> ìŒì£¼ìš´ì „ ì˜ˆë°© ë°©ì•ˆ ì œì‹œ</li>
                        <li><i class="fas fa-check-circle"></i> ì •ì±… ê°œì„  ì œì•ˆ</li>
                        <li><i class="fas fa-check-circle"></i> ì‹œê°í™” ì°¨íŠ¸ ë° ê·¸ë˜í”„ í¬í•¨</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- ê²°ì œ ëª¨ë‹¬ -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ê²°ì œí•˜ê¸°</h3>
                <button id="close-payment" class="close-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="payment-summary">
                    <h4>ì£¼ë¬¸ ìš”ì•½</h4>
                    <div id="payment-items"></div>
                    <div class="payment-total">
                        <strong>ê²°ì œ ê¸ˆì•¡: <span id="payment-total">1ì›</span></strong>
                    </div>
                </div>
                <div class="payment-form">
                    <h4>ê²°ì œ ì •ë³´</h4>
                    <form id="payment-form">
                        <div class="form-group">
                            <label>ì´ë¦„</label>
                            <input type="text" id="buyer-name" required>
                        </div>
                        <div class="form-group">
                            <label>ì´ë©”ì¼</label>
                            <input type="email" id="buyer-email" required>
                        </div>
                        <div class="form-group">
                            <label>ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="buyer-phone" required>
                        </div>
                        <div class="form-group">
                            <label>ê²°ì œ ë°©ë²•</label>
                            <select id="payment-method" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="card">ì‹ ìš©ì¹´ë“œ</option>
                                <option value="bank">ë¬´í†µì¥ì…ê¸ˆ</option>
                                <option value="kakaopay">ì¹´ì¹´ì˜¤í˜ì´</option>
                            </select>
                        </div>
                        <button type="submit" class="payment-submit-btn">ê²°ì œ ì™„ë£Œ</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê²°ì œ ëª¨ë‹¬ ê´€ë ¨ ë³€ìˆ˜
        const paymentModal = document.getElementById('payment-modal');
        const closePayment = document.getElementById('close-payment');
        const paymentForm = document.getElementById('payment-form');
        const paymentItems = document.getElementById('payment-items');
        
        // ê²°ì œ ëª¨ë‹¬ í‘œì‹œ
        function showPaymentForDownload() {
            // ì£¼ë¬¸ ìš”ì•½ í‘œì‹œ
            paymentItems.innerHTML = `
                <div class="payment-item">
                    <span>ìŒì£¼ìš´ì „ ì‹¬ì¸µë¶„ì„ ë¦¬í¬íŠ¸</span>
                    <span>1ì›</span>
                </div>
            `;
            
            // ê²°ì œ ëª¨ë‹¬ í‘œì‹œ
            paymentModal.classList.add('active');
        }
        
        // ê²°ì œ ëª¨ë‹¬ ë‹«ê¸°
        closePayment.addEventListener('click', () => {
            paymentModal.classList.remove('active');
        });
        
        // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ì‹œ ë‹«ê¸°
        paymentModal.addEventListener('click', (e) => {
            if (e.target === paymentModal) {
                paymentModal.classList.remove('active');
            }
        });
        
        // ê²°ì œ í¼ ì œì¶œ
        paymentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            processPayment();
        });
        
        // ê²°ì œ ì²˜ë¦¬
        function processPayment() {
            const buyerName = document.getElementById('buyer-name').value;
            const buyerEmail = document.getElementById('buyer-email').value;
            const buyerPhone = document.getElementById('buyer-phone').value;
            const paymentMethod = document.getElementById('payment-method').value;
            
            if (!buyerName || !buyerEmail || !buyerPhone || !paymentMethod) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(buyerEmail)) {
                alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì „í™”ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            const phoneRegex = /^01[0-9]-\d{3,4}-\d{4}$/;
            if (!phoneRegex.test(buyerPhone)) {
                alert('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 010-1234-5678)');
                return;
            }
            
            // ì‹œë®¬ë ˆì´ì…˜ ê²°ì œ ì²˜ë¦¬
            const submitBtn = document.querySelector('.payment-submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ê²°ì œ ì²˜ë¦¬ ì¤‘...';
            
            // 2ì´ˆ í›„ ê²°ì œ ì„±ê³µ ì²˜ë¦¬
            setTimeout(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                submitBtn.disabled = false;
                submitBtn.textContent = 'ê²°ì œ ì™„ë£Œ';
                
                // ê²°ì œ ì™„ë£Œ íŒì—… ë¨¼ì € í‘œì‹œ (ëª¨ë‹¬ ë‹«ê¸° ì „ì—)
                const userConfirmed = confirm('ğŸ‰ ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\në¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                
                // ê²°ì œ ëª¨ë‹¬ ë‹«ê¸°
                paymentModal.classList.remove('active');
                paymentForm.reset();
                
                // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
                if (userConfirmed) {
                    console.log('ì‚¬ìš©ìê°€ í™•ì¸ ë²„íŠ¼ì„ í´ë¦­í–ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ ì‹œì‘...');
                    
                    // ì•½ê°„ì˜ ì§€ì—° í›„ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰ (ë¸Œë¼ìš°ì €ê°€ confirm ì²˜ë¦¬ ì™„ë£Œ í›„)
                    setTimeout(() => {
                        try {
                            console.log('downloadReport í•¨ìˆ˜ í˜¸ì¶œ ì¤‘...');
                            const downloadPromise = downloadReport();
                            
                            if (downloadPromise && typeof downloadPromise.then === 'function') {
                                downloadPromise.then(() => {
                                    console.log('ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                                }).catch((error) => {
                                    console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                                    alert('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + (error.message || error));
                                });
                            } else {
                                console.error('downloadReportê°€ Promiseë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                                alert('ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                            }
                        } catch (error) {
                            console.error('ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë¥˜:', error);
                            alert('ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message);
                        }
                    }, 100);
                } else {
                    console.log('ì‚¬ìš©ìê°€ ì·¨ì†Œ ë²„íŠ¼ì„ í´ë¦­í–ˆìŠµë‹ˆë‹¤.');
                }
            }, 2000);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ì œ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const isPaid = urlParams.get('paid') === 'true';
            
            if (isPaid) {
                // ê²°ì œ ì™„ë£Œ í›„ ìë™ ë‹¤ìš´ë¡œë“œ
                setTimeout(() => {
                    downloadReport();
                }, 1000); // 1ì´ˆ í›„ ìë™ ë‹¤ìš´ë¡œë“œ
            }
        });
        
        function downloadReport() {
            const fileName = 'ìŒì£¼ìš´ì „_ì‹¬ì¸µë¶„ì„_ë¦¬í¬íŠ¸.pdf';
            
            // Firebase Storageì—ì„œ ë‹¤ìš´ë¡œë“œ ì‹œë„ (ì„¤ì •ëœ ê²½ìš°)
            if (window.firebaseStorage && window.firebaseStorageMethods) {
                return new Promise(async (resolve, reject) => {
                    try {
                        const { ref, getDownloadURL } = window.firebaseStorageMethods;
                        const storageRef = ref(window.firebaseStorage, 'reports/1_ìŒì£¼ìš´ì „.pdf');
                        const downloadUrl = await getDownloadURL(storageRef);
                        
                        // Firebase Storageì—ì„œ ë‹¤ìš´ë¡œë“œ
                        const link = document.createElement('a');
                        link.href = downloadUrl;
                        link.download = fileName;
                        link.target = '_blank';
                        link.style.display = 'none';
                        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        // ë‹¤ìš´ë¡œë“œ ì‹œì‘ í›„ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (ì•½ê°„ì˜ ì§€ì—°)
                        setTimeout(() => {
                            showDownloadSuccess();
                        }, 500);
                        
                        resolve();
                    } catch (error) {
                        console.warn('Firebase Storage ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ íŒŒì¼ë¡œ ì‹œë„:', error);
                        // Firebase Storage ì‹¤íŒ¨ ì‹œ ë¡œì»¬ íŒŒì¼ë¡œ fallback
                        // ë¡œì»¬ íŒŒì¼ ë‹¤ìš´ë¡œë“œë¡œ ê³„ì† ì§„í–‰
                        downloadLocalFile(fileName).then(resolve).catch(reject);
                    }
                });
            }
            
            // ë¡œì»¬ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (Firebase Storage ë¯¸ì„¤ì • ë˜ëŠ” ì‹¤íŒ¨ ì‹œ)
            return downloadLocalFile(fileName);
        }
        
        function downloadLocalFile(fileName) {
            return new Promise((resolve, reject) => {
                const pdfUrl = 'files/1_ìŒì£¼ìš´ì „.pdf';
                console.log('ë‹¤ìš´ë¡œë“œ ì‹œì‘:', pdfUrl);
                
                try {
                    // ì§ì ‘ ë§í¬ë¡œ ë‹¤ìš´ë¡œë“œ (ê°€ì¥ ì•ˆì •ì ì¸ ë°©ë²•)
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.download = fileName;
                    link.style.display = 'none';
                    
                    // bodyì— ì¶”ê°€
                    document.body.appendChild(link);
                    
                    // ì¦‰ì‹œ í´ë¦­ ì‹œë„
                    try {
                        link.click();
                        console.log('ë‹¤ìš´ë¡œë“œ ë§í¬ í´ë¦­ë¨');
                        
                        // ë‹¤ìš´ë¡œë“œ ì‹œì‘ í›„ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                        setTimeout(() => {
                            showDownloadSuccess();
                        }, 300);
                        
                        // ì •ë¦¬
                        setTimeout(() => {
                            if (link.parentNode) {
                                document.body.removeChild(link);
                            }
                            resolve();
                        }, 1000);
                    } catch (clickError) {
                        console.error('ë§í¬ í´ë¦­ ì˜¤ë¥˜:', clickError);
                        // ìƒˆ ì°½ìœ¼ë¡œ ì—´ê¸° ì‹œë„
                        window.open(pdfUrl, '_blank');
                        setTimeout(() => {
                            showDownloadSuccess();
                        }, 300);
                        resolve();
                    }
                } catch (error) {
                    console.error('ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ ì˜¤ë¥˜:', error);
                    reject(error);
                }
            });
        }
        
        function showDownloadSuccess() {
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(39, 174, 96, 0.3);
                z-index: 10000;
                font-weight: 600;
                font-size: 1.1rem;
                animation: slideInRight 0.3s ease;
            `;
            message.innerHTML = '<i class="fas fa-check-circle"></i> ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!';
            
            // ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€
            if (!document.querySelector('#download-animation-style')) {
                const style = document.createElement('style');
                style.id = 'download-animation-style';
                style.textContent = `
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(message);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                message.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.remove();
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
